{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import'bootstrap/dist/css/bootstrap.css';import Axios from\"axios\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function CargarImagen(){const[user,setUser]=useState('');const[archivo,setArchivo]=useState();const[allImg,setAllImg]=useState([]);const[base64Images,setBase64Images]=useState([]);//Obtiene valores de las fotos\nuseEffect(()=>{Axios.get(\"http://localhost:3001/getAllImg\").then(response=>{if(response.data===\"No imagen\"){alert(\"No hay imágenes\");}else{setAllImg(response.data);//console.log(response.data);\n}}).catch(error=>{console.error(\"Error fetching images:\",error);});},[]);//Conversion de los valores a un base64\nuseEffect(()=>{const convertImagesToBase64=async()=>{const base64Promises=allImg.map(val=>{const blob=new Blob([new Uint8Array(val.foto_usuario.data)],{type:'image/jpeg'});const reader=new FileReader();reader.readAsDataURL(blob);return new Promise(resolve=>{reader.onloadend=()=>{resolve(reader.result.split(',')[1]);};});});try{const base64Strings=await Promise.all(base64Promises);setBase64Images(base64Strings);}catch(error){console.error(\"Error converting images to base64:\",error);}};if(allImg.length>0){convertImagesToBase64();}},[allImg]);const submit=e=>{e.preventDefault();const frmData=new FormData();frmData.append(\"file\",archivo);frmData.append(\"user\",user);Axios.post(\"http://localhost:3001/file\",frmData,{headers:{'Content-Type':'multipart/form-data'}}).then(response=>{if(response.data.alert===\"Success\"){// Una vez que la imagen se ha subido exitosamente, puedes recargar la lista de imágenes\nAxios.get(\"http://localhost:3001/getAllImg\").then(response=>{if(response.data===\"No imagen\"){alert(\"No hay imágenes\");}else{setAllImg(response.data);}}).catch(error=>{console.error(\"Error fetching images:\",error);});}console.log(response.data);}).catch(error=>{console.error(\"Error submitting form:\",error);});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre de usuario\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Usuario\",value:user,onChange:e=>{setUser(e.target.value);}}),/*#__PURE__*/_jsx(\"label\",{children:\"Archivo\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",onChange:e=>{setArchivo(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:submit,children:\"Enviar\"})]}),base64Images.map((base64String,index)=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:`data:image/jpeg;base64,${base64String}`,className:\"casr-img-top\",style:{width:'18rem'}}),/*#__PURE__*/_jsx(\"h5\",{className:\"car-title\",children:allImg[index].nickname_usuario})]},index))]});}export default CargarImagen;","map":{"version":3,"names":["React","useEffect","useState","Axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CargarImagen","user","setUser","archivo","setArchivo","allImg","setAllImg","base64Images","setBase64Images","get","then","response","data","alert","catch","error","console","convertImagesToBase64","base64Promises","map","val","blob","Blob","Uint8Array","foto_usuario","type","reader","FileReader","readAsDataURL","Promise","resolve","onloadend","result","split","base64Strings","all","length","submit","e","preventDefault","frmData","FormData","append","post","headers","log","children","placeholder","value","onChange","target","files","className","onClick","base64String","index","src","style","width","nickname_usuario"],"sources":["D:/Clases/Programacion Web II/PW2_Project/pw2/front/src/CargarImage.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport 'bootstrap/dist/css/bootstrap.css';\nimport Axios from \"axios\";\n\nfunction CargarImagen() {\n    const [user, setUser] = useState('');\n    const [archivo, setArchivo] = useState();\n    const [allImg, setAllImg] = useState([]);\n    const [base64Images, setBase64Images] = useState([]);\n\n    //Obtiene valores de las fotos\n    useEffect(() => {\n        Axios.get(\"http://localhost:3001/getAllImg\")\n            .then((response) => {\n                if (response.data === \"No imagen\") {\n                    alert(\"No hay imágenes\");\n                } else {\n                    setAllImg(response.data);\n                    //console.log(response.data);\n                }\n            })\n            .catch((error) => {\n                console.error(\"Error fetching images:\", error);\n            });\n    }, []);\n\n    //Conversion de los valores a un base64\n    useEffect(() => {\n        const convertImagesToBase64 = async () => {\n            const base64Promises = allImg.map((val) => {\n                const blob = new Blob([new Uint8Array(val.foto_usuario.data)], { type: 'image/jpeg' });\n                const reader = new FileReader();\n                reader.readAsDataURL(blob);\n                return new Promise((resolve) => {\n                    reader.onloadend = () => {\n                        resolve(reader.result.split(',')[1]);\n                    };\n                });\n            });\n\n            try {\n                const base64Strings = await Promise.all(base64Promises);\n                setBase64Images(base64Strings);\n            } catch (error) {\n                console.error(\"Error converting images to base64:\", error);\n            }\n        };\n\n        if (allImg.length > 0) {\n            convertImagesToBase64();\n        }\n    }, [allImg]);\n\n    const submit = (e) => {\n        e.preventDefault();\n\n        const frmData = new FormData();\n        frmData.append(\"file\", archivo);\n        frmData.append(\"user\", user);\n\n        Axios.post(\"http://localhost:3001/file\", frmData, {\n            headers: { 'Content-Type': 'multipart/form-data' }\n        })\n            .then((response) => {\n                if (response.data.alert === \"Success\") {\n                    // Una vez que la imagen se ha subido exitosamente, puedes recargar la lista de imágenes\n                    Axios.get(\"http://localhost:3001/getAllImg\")\n                        .then((response) => {\n                            if (response.data === \"No imagen\") {\n                                alert(\"No hay imágenes\");\n                            } else {\n                                setAllImg(response.data);\n                            }\n                        })\n                        .catch((error) => {\n                            console.error(\"Error fetching images:\", error);\n                        });\n                }\n                console.log(response.data);\n            })\n            .catch((error) => {\n                console.error(\"Error submitting form:\", error);\n            });\n    };\n\n    return (\n        <>\n            <div>\n                <label>Nombre de usuario</label>\n                <input type=\"text\" placeholder=\"Usuario\"\n                    value={user} onChange={(e) => { setUser(e.target.value) }} />\n\n                <label>Archivo</label>\n                <input type=\"file\"\n                    onChange={(e) => { setArchivo(e.target.files[0]) }} />\n\n                <button className=\"btn btn-primary\" onClick={submit}>Enviar</button>\n            </div>\n\n            {base64Images.map((base64String, index) => (\n                <div key={index}>\n                    <img src={`data:image/jpeg;base64,${base64String}`}\n                        className=\"casr-img-top\" style={{ width: '18rem' }} />\n                    <h5 className=\"car-title\">{allImg[index].nickname_usuario}</h5>\n                </div>\n            ))}\n        </>\n    );\n}\n\nexport default CargarImagen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}